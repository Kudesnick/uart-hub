/***************************************************************************************************
 *   Project:
 *   Author:        Stulov Tikhon
 ***************************************************************************************************
 *   Distribution:
 *
 ***************************************************************************************************
 *   MCU Family:    STM32F
 *   Compiler:      ARMCC
 ***************************************************************************************************
 *   File:          cpp_tmr.cpp
 *   Description:   неблокирующий механизм отсчета временных интервалов
 *
 ***************************************************************************************************
 *   History:       17.12.2019 - file created
 *
 **************************************************************************************************/

/***************************************************************************************************
 *                                      INCLUDED FILES
 **************************************************************************************************/

#include "cpp_tmr.h"
#include "cpp_os.h"

/***************************************************************************************************
 *                                       DEFINITIONS
 **************************************************************************************************/

/***************************************************************************************************
 *                                      PRIVATE TYPES
 **************************************************************************************************/

/***************************************************************************************************
 *                               PRIVATE FUNCTION PROTOTYPES
 **************************************************************************************************/

/***************************************************************************************************
 *                                       PRIVATE DATA
 **************************************************************************************************/

/***************************************************************************************************
 *                                       PUBLIC DATA
 **************************************************************************************************/

/***************************************************************************************************
 *                                      EXTERNAL DATA
 **************************************************************************************************/

/***************************************************************************************************
 *                              EXTERNAL FUNCTION PROTOTYPES
 **************************************************************************************************/

/***************************************************************************************************
 *                                    PRIVATE FUNCTIONS
 **************************************************************************************************/

/***************************************************************************************************
 *                                    PUBLIC FUNCTIONS
 **************************************************************************************************/

cpp_tmr::cpp_tmr(const uint32_t _delay):
    delay(_delay)
{
    reset();
};

void cpp_tmr::reset(void)
{
    timestamp = cpp_os::get_tick_count();
};

void cpp_tmr::inc(void)
{
    timestamp += delay;
};

bool cpp_tmr::is_ovf(void)
{
    return ((cpp_os::get_tick_count() - timestamp) > delay);
};

void cpp_tmr::ovf_wait(void)
{
    cpp_os::delay_until(timestamp + delay);
};

/***************************************************************************************************
 *                                       END OF FILE
 **************************************************************************************************/
